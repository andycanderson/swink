<!DOCTYPE html>
<html ng-app="ApplicantApp">
<head>
  <title>Swink!</title>
  <%= stylesheet_link_tag    "application", media: "all", "data-turbolinks-track" => true %>
  <%= javascript_include_tag "application", "data-turbolinks-track" => true %>
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.0-rc.4/angular.min.js"></script>

  <%= csrf_meta_tags %>
</head>
<body class="applicants-body" ng-controller="applicantCtrl">

<!-- nav bar addition -->
<nav class="navbar" role="navigation">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li class="inline button" ng-click="toggle(getProfileInfo(), 'n')"
ng-init="editProfile=false" ng-class="{selected: editProfile}">Edit Profile</li>
         <li class="inline button" ng-init="searchDiv=false" ng-click="toggle(searchDiv, 's')" ng-class="{selected: searchDiv}">Liked Jobs</li>
         <li class="inline button"  ng-init="showPosting=true" ng-click="toggle(showPosting, 'p')", ng-class="{selected: showPosting}">My Job List</li>
         <li class="inline button lineheight"><a href="/signout"><%= link_to "Log Out", sign_out_path, method: :delete%></a></li>
      </ul>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>
<!--
<%if !(current_page? controller: 'home', action: 'index')%>
<%= link_to "Log Out", sign_out_path, method: :delete %>
<%end%>
-->

<%= yield %>

<script>
	angular.module('ApplicantApp', [])
	.config(["$httpProvider", function($httpProvider){
	  $httpProvider.defaults.headers.common['X-CSRF-Token'] = $('meta[name=csrf-token]').attr('content')
	}])

	.controller('applicantCtrl', ['$scope', '$http', function($scope, $http) {
		console.log("Angular Ready");
		
		// when first landing or refreshing
		$scope.load = function(){$http.get('/applicant.json').success(function(data){
				$scope.editProfile = false;
				$scope.link = data.link;
				$scope.tag_list = data.tag_list;
				$scope.tags = data.tags;
				$scope.feed = data.feed;
				$scope.liked = data.liked;
			});
		}
		$scope.load();


		$scope.getProfileInfo = function(){
			$http.get('/myprofile.json').success(function(data){
				$scope.link = data.link;
				$scope.tag_list = data.tag_list;
				$scope.editProfile = !$scope.editProfile;
			});
		}

		$scope.saveProfile = function(link, tag_list){
			$http.patch('/myprofile.json', {link: link, tag_list: tag_list}).success(function(data){
					// hide after changing
					$scope.editProfile = !$scope.editProfile;
					$http.get('/applicant.json').success(function(data){
						console.log(data);
						$scope.profileData = data;
						$scope.tags = data.tags;
						$scope.feed = data.feed;
						$scope.liked = data.feed;
					});
			});
		}

		$scope.like = function(id){
			$http.get('/like/'+id).success(function(data){
				$scope.load();
			});
		}

		$scope.dislike = function(id){
			$http.get('/dislike/'+id).success(function(data){
				$scope.load();
			});
		}

		// for toggling through menu (on/off)
		$scope.toggle = function(x, y){
			if(x==false){
				if(y=="n")
				{	
					$scope.editProfile=true;
					$scope.showPosting=false;
					$scope.searchDiv=false;
					$scope.showNotifications=false;
				}
				else if(y=="p")
				{
					$scope.editProfile=false;
					$scope.showPosting=true;
					$scope.searchDiv=false;
					$scope.showNotifications=false;
				}
				else if(y=="s")
				{
					$scope.editProfile=false;
					$scope.showPosting=false;
					$scope.searchDiv=true;
					$scope.showNotifications=false;
				}
				else if(y=="not")
				{
					$scope.editProfile=false;
					$scope.showPosting=false;
					$scope.searchDiv=false;
					$scope.showNotifications=true;
				}
			}
		}

	 }]);
</script>
</body>
</html>
