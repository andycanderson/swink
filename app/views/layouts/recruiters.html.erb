<!DOCTYPE html>
<html ng-app="RecruiterApp">
<head>
  <title>Swink!</title>
  <%= stylesheet_link_tag    "application", media: "all", "data-turbolinks-track" => true %>
  <%= javascript_include_tag "application", "data-turbolinks-track" => true %>
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.0-rc.4/angular.min.js"></script>
  <%= csrf_meta_tags %>
  
</head>

<body class="recruiters-body" ng-controller="recruiterCtrl">

<%if !(current_page? controller: 'home', action: 'index')%>
<%= link_to "Log Out", sign_out_path, method: :delete %>
<%end%>

<%= yield %>

<script>
	angular.module('RecruiterApp', [])
	.config(["$httpProvider", function($httpProvider){
	  $httpProvider.defaults.headers.common['X-CSRF-Token'] = $('meta[name=csrf-token]').attr('content')
	}])
	.controller('recruiterCtrl', ['$scope', '$http', function($scope, $http) {
		console.log("Angular Ready");
		$scope.tagArray = [];
		$scope.addTag = function(tag, addRemove){
			if (addRemove == true){ 
				$scope.tagArray.push(tag);
			}
			else
			{
				var index = $scope.tagArray.indexOf(tag);
				$scope.tagArray.splice(index, 1);
			}
			console.log($scope.tagArray);			
		}

		$scope.checkArray = function(tagName){
			// not there
			if ($scope.tagArray.indexOf(tagName) != -1){
				return false;
			}
			// there
			else{
				return true;
			}
		}

		// load past jobs
		$scope.getPostings = function(){
			$http.get('/recruiter.json').success(function(data){
				$scope.postings = data.postings;
				$scope.tags = data.tags;
			});
		}
		$scope.getPostings();

		$scope.search = function(tags){
			console.log(tags);
			console.log("searching");
			$http.post('/searchprofile', {tags: tags}).success(function(data){
				console.log(data);
				$scope.applicants = data;
			});
		}

		


	 }]);
</script>
</body>
</html>
