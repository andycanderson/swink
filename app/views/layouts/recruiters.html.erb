<!DOCTYPE html>
<html ng-app="RecruiterApp">
<head>
  <title>Swink!</title>
  <%= stylesheet_link_tag    "application", media: "all", "data-turbolinks-track" => true %>
  <%= javascript_include_tag "application", "data-turbolinks-track" => true %>
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.0-rc.4/angular.min.js"></script>
  <%= csrf_meta_tags %>
  
</head>

<body class="recruiters-body" ng-controller="recruiterCtrl">

<%if !(current_page? controller: 'home', action: 'index')%>
<%= link_to "Log Out", sign_out_path, method: :delete %>
<%end%>

<%= yield %>

<script>
	angular.module('RecruiterApp', [])
	.config(["$httpProvider", function($httpProvider){
	  $httpProvider.defaults.headers.common['X-CSRF-Token'] = $('meta[name=csrf-token]').attr('content')
	}])
	.controller('recruiterCtrl', ['$scope', '$http', function($scope, $http) {
		console.log("Angular Ready");

		// initialize empty search array
		$scope.tagArray = [];

		// add or remove tags for search
		$scope.addTag = function(tag, addRemove){
			// add tag from array
			if (addRemove == true){ 
				$scope.tagArray.push(tag);
			}
			// remove tag from array
			else
			{
				var index = $scope.tagArray.indexOf(tag);
				$scope.tagArray.splice(index, 1);
			}
			console.log($scope.tagArray);			
		}

		// to control toggle of tag buttons
		$scope.checkArray = function(tagName){
			// tag in array
			if ($scope.tagArray.indexOf(tagName) != -1){
				return false;
			}
			// tag not in array
			else{
				return true;
			}
		}

		// posting tag array
		$scope.postingTagArray =[];

		// 
		$scope.postingAddTag = function(tag, addRemove){
			// add tag from array
			if (addRemove == true){ 
				$scope.postingTagArray.push(tag);
			}
			// remove tag from array
			else
			{
				var index = $scope.postingTagArray.indexOf(tag);
				$scope.postingTagArray.splice(index, 1);
			}
			console.log($scope.postingTagArray);
		}

		// to control toggle of posting array
		$scope.checkPostingArray = function(tagName){
			// tag in posting array
			if ($scope.postingTagArray.indexOf(tagName) != -1){
				return false;
			}
			// tag not in posting array
			else{
				return true;
			}
		}

		// make new posting
		$scope.makeNewPosting = function(title, description, postingTagArray){
			console.log("making");
			$http.post('/newposting', {title: title, description: description, postingTagArray: postingTagArray}).success(function(data){
					$scope.newPosting = !$scope.newPosting;
					$scope.getPostings();
			});
		}

		// load past jobs
		$scope.getPostings = function(){
			$http.get('/recruiter.json').success(function(data){
				$scope.postings = data.postings;
				$scope.tags = data.tags;
			});
		}
		// get all postings made by recruiter
		$scope.getPostings();

		// search function
		$scope.search = function(tags){
			console.log(tags);
			console.log("searching");
			$http.post('/searchprofile', {tags: tags}).success(function(data){
				console.log(data);
				$scope.applicants = data;
			});
		}

		


	 }]);
</script>
</body>
</html>
